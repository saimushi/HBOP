<?xml version="1.0" ?>
<xml>
	<section id="Managementproject">
		<execute>
			<assign var="res" class="Auth" method="isCertification"/>
			<if var="res" val="true">
				<assign var="res"  method="isset" arg1="Flow::$params['get']['target_project']"/>
				<if var="res" val="false">
					<exception/>
				</if>
				<assign var="res"  method="strlen" arg1="Flow::$params['get']['target_project']"/>
				<if var="res" val="0">
					<exception/>
				</if>
				<flowviewparam selector="#baseURL" val="getConfig('BASE_URL', Flow::$params['get']['target_project'])"/>
				<flowviewparam selector="#baseURL" val="array(HtmlViewAssignor::REPLACE_ATTR_KEY => array('href' => getConfig('BASE_URL', Flow::$params['get']['target_project'])))"/>
				<flowviewparam selector="#DB_DSN" val="getConfig('DB_DSN', Flow::$params['get']['target_project'])"/>
				<flowviewparam selector="#createdb" val="file_get_contents(getConfig('PROJECT_ROOT_PATH', Flow::$params['get']['target_project']).'core/createdb.sql')"/>
				<flowviewparam selector="#createtable" val="file_get_contents(getConfig('PROJECT_ROOT_PATH', Flow::$params['get']['target_project']).'core/createtable.sql')"/>
				<assign var="useAutoGenerate" method="getAutoGenerateEnabled" arg1="Flow::$params['get']['target_project']"/>
				<if var="useAutoGenerate" val="true">
					<assign var="useAutoGenerate" val="string:on"/>
					<flowviewparam selector="#useAutoGenerate" val="$useAutoGenerate"/>
				</if>
				<assign var="useAutoMigration" method="getAutoMigrationEnabled" arg1="Flow::$params['get']['target_project']"/>
				<if var="useAutoMigration" val="true">
					<assign var="useAutoMigration" val="string:on"/>
					<flowviewparam selector="#useAutoMigration" val="$useAutoMigration"/>
				</if>
				<assign var="useAutoStageCheck" method="getAutoStageCheckEnabled" arg1="Flow::$params['get']['target_project']"/>
				<if var="useAutoStageCheck" val="1">
					<assign var="useAutoStageCheck" val="string:on"/>
					<flowviewparam selector="#useAutoStageCheck" val="$useAutoStageCheck"/>
				</if>
				<assign var="isLocal" method="getLocalEnabled" arg1="Flow::$params['get']['target_project']"/>
				<if var="isLocal" val="1">
					<assign var="isLocal" val="string:on"/>
					<flowviewparam selector="#isLocal" val="$isLocal"/>
				</if>
				<assign var="isTest" method="getTestEnabled" arg1="Flow::$params['get']['target_project']"/>
				<if var="isTest" val="1">
					<assign var="isTest" val="string:on"/>
					<flowviewparam selector="#isTest" val="$isTest"/>
				</if>
				<assign var="isDevelopment" method="getDevelopmentEnabled" arg1="Flow::$params['get']['target_project']"/>
				<if var="isDevelopment" val="1">
					<assign var="isDevelopment" val="string:on"/>
					<flowviewparam selector="#isDevelopment" val="$isDevelopment"/>
				</if>
				<assign var="isStaging" method="getStagingEnabled" arg1="Flow::$params['get']['target_project']"/>
				<if var="isStaging" val="1">
					<assign var="isStaging" val="string:on"/>
					<flowviewparam selector="#isStaging" val="$isStaging"/>
				</if>
				<assign var="isDebug" method="getDebugEnabled" arg1="Flow::$params['get']['target_project']"/>
				<if var="isDebug" val="1">
					<assign var="isDebug" val="string:on"/>
					<flowviewparam selector="#isDebug" val="$isDebug"/>
				</if>
				<assign var="stageTest" method="isTest" arg1="Flow::$params['get']['target_project']"/>
				<if var="stageTest" val="true">
					<assign var="stageTest" val="string:on"/>
					<flowviewparam selector="#stageTest" val="$stageTest"/>
				</if>
				<view baseview="base" flowpostformsection="web/generatenewproject-execute"/>
			</if>
			<else>
				<flow section="web/login"/>
			</else>
		</execute>
	</section>
	<section id="Generatenewproject-execute">
		<execute>
			<assign var="res" class="Auth" method="isCertification"/>
			<if var="res" val="true">
				<if var="autoValidated" val="true">
					<assign var="res" class="ProjectManager" method="createProject" arg1="Flow::$params['post']['project_name_must']"/>
					<if var="res" val="true">
						<view baseview="base"/>
					</if>
					<else>
						<flowpostformsectionerror>プロジェクトの作成に失敗しました</flowpostformsectionerror>
					</else>
				</if>
				<else>
					<flowpostformsectionerror>プロジェクト名は必ず指定して下さい</flowpostformsectionerror>
				</else>
				<view section="Generatenewproject" flowpostformsection="web/Generatenewproject-execute" baseview="base"/>
			</if>
			<else>
				<flow section="web/login"/>
			</else>
		</execute>
	</section>
</xml>