<?xml version="1.0" ?>
<xml>
	<section id="Managementproject">
		<execute>
			<assign var="res" class="Auth" method="isCertification"/>
			<if var="res" val="true">
				<assign var="res"  method="isset" arg1="Flow::$params['get']['target_project']"/>
				<if var="res" val="false">
					<exception/>
				</if>
				<assign var="res"  method="strlen" arg1="Flow::$params['get']['target_project']"/>
				<if var="res" val="0">
					<exception/>
				</if>
				<flowviewparam selector="#baseURL" val="getConfig('BASE_URL', Flow::$params['get']['target_project'])"/>
				<flowviewparam selector="#baseURL" val="array(HtmlViewAssignor::REPLACE_ATTR_KEY => array('href' => getConfig('BASE_URL', Flow::$params['get']['target_project'])))"/>
				<flowviewparam selector="#DB_DSN" val="getConfig('DB_DSN', Flow::$params['get']['target_project'])"/>
				<flowviewparam selector="#createdb" val="file_get_contents(getConfig('PROJECT_ROOT_PATH', Flow::$params['get']['target_project']).'core/createdb.sql')"/>
				<flowviewparam selector="#createtable" val="file_get_contents(getConfig('PROJECT_ROOT_PATH', Flow::$params['get']['target_project']).'core/createtable.sql')"/>
				<assign var="projectconf" val="simplexml_load_file(getConfigPathForConfigName(Flow::$params['get']['target_project']))"/>
				<assign var="configs" val="array()"/>
				<foreach eachas="projectconf">
					<assign var="childeCount" val="$projectconfval->count()"/>
					<if var="childeCount" style="&gt;" val="1">
						<assign var="configs[]" val="array(array('.config-node-key' => 'ConfigureName:', '.config-node-val' => $projectconfkey), array('.config-node-key' => array(HtmlViewAssignor::REPLACE_ATTR_KEY => array('class' => 'configname config-node-key'))))"/>
						<foreach eachas="projectconfval">
							<assign var="attribute" val="''"/>
							<assign var="attributeCount" val="count($projectconfvalval->attributes())"/>
							<if var="attributeCount" style="!=" val="0">
								<assign var="tmpAttributes" val="$projectconfvalval->attributes()"/>
								<assign var="attributes" val="array()"/>
								<foreach eachas="tmpAttributes">
									<assign var="attributes[]" val="$tmpAttributeskey.'='.$tmpAttributesval"/>
								</foreach>
								<assign var="attribute" val="' ('.implode(',',$attributes).')'"/>
							</if>
							<assign var="configs[]" val="array(array('.config-node-key' => $projectconfvalkey.$attribute, '.config-node-val' => $projectconfvalval->__toString()), array('.config-node-key' => array(HtmlViewAssignor::REPLACE_ATTR_KEY => array('class' => 'config-node-key'))))"/>
						</foreach>
					</if>
					<else>
						<assign var="attribute" val="''"/>
						<assign var="attributeCount" val="count($projectconfval->attributes())"/>
						<if var="attributeCount" style="!=" val="0">
							<assign var="tmpAttributes" val="$projectconfval->attributes()"/>
							<assign var="attributes" val="array()"/>
							<foreach eachas="tmpAttributes">
								<assign var="attributes[]" val="$tmpAttributeskey.'='.$tmpAttributesval"/>
							</foreach>
							<assign var="attribute" val="' ('.implode(',',$attributes).')'"/>
						</if>
						<assign var="configs[]" val="array(array('.config-node-key' => $projectconfkey.$attribute, '.config-node-val' => $projectconfval->__toString()), array('.config-node-key' => array(HtmlViewAssignor::REPLACE_ATTR_KEY => array('class' => 'config-node-key'))))"/>
					</else>
				</foreach>
				<flowviewparam selector=".config-node" val="array(HtmlViewAssignor::LOOP_NODE_KEY => $configs)"/>
				<assign var="useAutoGenerate" method="getAutoGenerateEnabled" arg1="Flow::$params['get']['target_project']"/>
				<if var="useAutoGenerate" val="true">
					<assign var="useAutoGenerate" val="string:on"/>
					<flowviewparam selector="#useAutoGenerate" val="$useAutoGenerate"/>
				</if>
				<assign var="useAutoMigration" method="getAutoMigrationEnabled" arg1="Flow::$params['get']['target_project']"/>
				<if var="useAutoMigration" val="true">
					<assign var="useAutoMigration" val="string:on"/>
					<flowviewparam selector="#useAutoMigration" val="$useAutoMigration"/>
				</if>
				<assign var="useAutoStageCheck" method="getAutoStageCheckEnabled" arg1="Flow::$params['get']['target_project']"/>
				<if var="useAutoStageCheck" val="1">
					<assign var="useAutoStageCheck" val="string:on"/>
					<flowviewparam selector="#useAutoStageCheck" val="$useAutoStageCheck"/>
				</if>
				<assign var="isLocal" method="getLocalEnabled" arg1="Flow::$params['get']['target_project']"/>
				<if var="isLocal" val="1">
					<assign var="isLocal" val="string:on"/>
					<flowviewparam selector="#isLocal" val="$isLocal"/>
				</if>
				<assign var="isTest" method="getTestEnabled" arg1="Flow::$params['get']['target_project']"/>
				<if var="isTest" val="1">
					<assign var="isTest" val="string:on"/>
					<flowviewparam selector="#isTest" val="$isTest"/>
				</if>
				<assign var="isDevelopment" method="getDevelopmentEnabled" arg1="Flow::$params['get']['target_project']"/>
				<if var="isDevelopment" val="1">
					<assign var="isDevelopment" val="string:on"/>
					<flowviewparam selector="#isDevelopment" val="$isDevelopment"/>
				</if>
				<assign var="isStaging" method="getStagingEnabled" arg1="Flow::$params['get']['target_project']"/>
				<if var="isStaging" val="1">
					<assign var="isStaging" val="string:on"/>
					<flowviewparam selector="#isStaging" val="$isStaging"/>
				</if>
				<assign var="isDebug" method="getDebugEnabled" arg1="Flow::$params['get']['target_project']"/>
				<if var="isDebug" val="1">
					<assign var="isDebug" val="string:on"/>
					<flowviewparam selector="#isDebug" val="$isDebug"/>
				</if>
				<assign var="stageTest" method="isTest" arg1="FALSE" arg2="Flow::$params['get']['target_project']"/>
				<if var="stageTest" val="true">
					<assign var="stageTest" val="string:on"/>
					<flowviewparam selector="#stageTest" val="$stageTest"/>
				</if>
				<view baseview="base" flowpostformsection="web/generatenewproject-execute"/>
			</if>
			<else>
				<flow section="web/login"/>
			</else>
		</execute>
	</section>
	<section id="Managementproject-modifyflags">
		<execute>
			<assign var="res" class="Auth" method="isCertification"/>
			<if var="res" val="true">
				<if var="res" val="false">
					<exception/>
				</if>
				<assign var="res"  method="strlen" arg1="Flow::$params['get']['target_project']"/>
				<if var="res" val="0">
					<exception/>
				</if>
				<view baseview="base"/>
			</if>
			<else>
				<flow section="web/login"/>
			</else>
		</execute>
	</section>
	<section id="Managementproject-modifyconfigure">
		<execute>
			<assign var="res" class="Auth" method="isCertification"/>
			<if var="res" val="true">
				<assign var="res"  method="isset" arg1="Flow::$params['get']['target_project']"/>
				<if var="res" val="false">
					<exception/>
				</if>
				<assign var="res"  method="strlen" arg1="Flow::$params['get']['target_project']"/>
				<if var="res" val="0">
					<exception/>
				</if>
				<assign var="res"  method="isset" arg1="Flow::$params['post']['modify']"/>
				<if var="res" val="false">
					<flowviewparam selector="#configxml" val="htmlspecialchars(file_get_contents(getConfigPathForConfigName(Flow::$params['get']['target_project'])))"/>
				</if>
				<else>
					<assign var="res"  method="simplexml_load_string" arg1="Flow::$params['post']['configxml']"/>
					<if var="res" val="false">
						<flowpostformsectionerror>(!)XMLの形式に間違があります! 保存しませんでした。&lt;br/&gt;正しいXMLに修正してから保存して下さい。</flowpostformsectionerror>
					</if>
					<else>
						<assign var="res"  method="file_put_contents" arg1="getConfigPathForConfigName(Flow::$params['get']['target_project'])" arg2="str_replace('  ', PHP_TAB, Flow::$params['post']['configxml'])"/>
						<flowpostformsectionerror>コンフィグ設定の変更を保存しました。</flowpostformsectionerror>
						<flowviewparam selector="#modified-message" val="array(HtmlViewAssignor::REPLACE_ATTR_KEY => array('class' => 'white errormsg'))"/>
					</else>
					<flowviewparam selector="#configxml" val="htmlspecialchars(Flow::$params['post']['configxml'])"/>
				</else>
				<view baseview="base" flowpostformsection="web/managementproject-modifyconfigure"/>
			</if>
			<else>
				<flow section="web/login"/>
			</else>
		</execute>
	</section>
	<section id="Managementproject-modifydbsettings">
		<execute>
			<assign var="res" class="Auth" method="isCertification"/>
			<if var="res" val="true">
				<if var="res" val="false">
					<exception/>
				</if>
				<assign var="res"  method="strlen" arg1="Flow::$params['get']['target_project']"/>
				<if var="res" val="0">
					<exception/>
				</if>
				<view baseview="base"/>
			</if>
			<else>
				<flow section="web/login"/>
			</else>
		</execute>
	</section>
</xml>